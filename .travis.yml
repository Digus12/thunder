language: cpp
sudo: required
dist: trusty

env:
  global:
    - secure: "cIkSIuSmwqo8uZVl+Dhpq2lFbyOKg5pkIazFyRLlyqUVALVyzPnrBXtpsS2Y0B4V2niHTUrKY5gLuSlCuQ+6JtPThttKA+YQFF2gdQbTuoIEyzNXjLSRvwEkp33XK4n+VkG1y7QT6PCKoGjvWWnFYKxghV4wp9/UWBWH7Qgxhc+y5rV3388KHqGw0hlg1ylIbbEYsUsPDb62QBR2VJmOKx+mizioYGuClyQXTeqTiFAZnrgH/4lTXETEfjekr6TndAXwk1qwq+dlsZL1lPMmgJlnjsSGKW3MPjQdwQXi6+qTQIzj1iOcgqID6aux74WTkqwsDV+hEko8QJAPJaJnYu8MCM9+2GnhfLpSwU+vAmUxwcc9zrie3TPJnx9xe3qnKhFYPA7OtwM5/MGYojvLnzdV3/m9+9rjex+0XZwX0zH3fnnGYzc0wcqBJaQjaMc2OBtp5Fs8hj+a2xBWO86SUFFuWCdD7TvrQ8Ctwl2kO4s05OgIHxMneDhicLg6AR8pcdITRggbs4ufvBmT+oc5ul/vxgXJI+DiUm3U8vObNZi9xLj6uIJpiuHZ/SN0FR4u4MW9UjlrwPivFYcUBaxKdIEwBrcEkaHfjyYlLhJ9Q2wO2bp5bMD4RSLG5Lzgfb1OoZhmLqRSOFpGyfZXPm8c0PnUtCqY8KfTXnvQFDiTFw0="

before_install:
  - echo -n | openssl s_client -connect https://scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-

addons:
  coverity_scan:
    project:
      name: "eprikazchikov/thunder"
      description: "Cross Platform Game Engine"
    notification_email: eprikazchikov@mail.ru
    build_command_prepend: "qbs --version"
    build_command: "qbs build"
    branch_pattern: coverity_scan

matrix:
  include:
    - os: osx
      before_install:
        - brew update
        - brew install qbs
        - install_name_tool -id "@rpath/../Frameworks/QtCore" /usr/local/opt/qt/lib/QtCore.framework/Versions/5/QtCore
        - install_name_tool -id "@rpath/../Frameworks/QtGui" /usr/local/opt/qt/lib/QtGui.framework/Versions/5/QtGui
        - install_name_tool -id "@rpath/../Frameworks/QtWidgets" /usr/local/opt/qt/lib/QtWidgets.framework/Versions/5/QtWidgets
        - install_name_tool -id "@rpath/../Frameworks/QtScript" /usr/local/opt/qt/lib/QtScript.framework/Versions/5/QtScript
        - install_name_tool -id "@rpath/../Frameworks/QtXml" /usr/local/opt/qt/lib/QtXml.framework/Versions/5/QtXml
        - install_name_tool -id "@rpath/../Frameworks/QtNetwork" /usr/local/opt/qt/lib/QtNetwork.framework/Versions/5/QtNetwork
      script:
        - qbs --version
        - qbs setup-toolchains --detect
        - qbs setup-qt /usr/local/opt/qt/bin/qmake qt-brew
        - qbs config profiles.qt-brew.baseProfile xcode-macosx-x86_64
        - qbs config defaultProfile qt-brew
        - qbs install --all-products config:release
      after_success:
        "curl --ftp-create-dirs -T ThunderEngine-macos-x86_64.tar.gz -u $FTP_USER:$FTP_PASSWORD ftp://ftp.thunderengine.ru/ThunderEngine-macos-x86_64.tar.gz"
